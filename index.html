<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Truck: Econ Edition</title>
    <style>
        :root {
            --bg-color: #FDF1D6;       
            --box-bg: #FCEFC7;         
            --teal-btn: #00BFA5;       
            --teal-hover: #008F7A;
            --blue-border: #2D74DA;    
            --overlay-bg: rgba(0,0,0,0.6);
            --text-dark: #333333;
            --orange-alert: #F5A623;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-dark);
        }

        .container {
            width: 100%;
            max-width: 950px;
            text-align: center;
        }

        .hidden { display: none !important; }

        /* --- HEADER & PROD BAR --- */
        .prod-bar {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            border: 2px solid var(--blue-border);
            border-radius: 10px;
            padding: 10px 40px;
            background: rgba(255,255,255,0.6);
            font-size: 18px;
            font-weight: bold;
            color: var(--blue-border);
            margin-bottom: 20px;
        }

        /* --- GAME GRID --- */
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 30px;
            align-items: start;
        }

        /* LEFT: PREP TIME */
        .prep-box {
            background-color: var(--box-bg);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ecdca8;
        }

        .input-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            background: white;
            border: 2px solid var(--teal-btn);
            border-radius: 8px;
            overflow: hidden;
            height: 50px;
        }

        .control-btn {
            background: var(--teal-btn);
            color: white;
            border: none;
            width: 45px;
            height: 100%;
            font-size: 24px;
            cursor: pointer;
        }

        /* RIGHT: OUTPUT & TRADING */
        .output-box {
            background: white;
            border: 2px solid var(--blue-border);
            border-radius: 12px;
            padding: 20px;
        }

        .inventory-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .trade-diff { font-size: 14px; margin-left: 5px; }
        .diff-pos { color: green; font-weight: bold; }
        .diff-neg { color: red; font-weight: bold; }

        .action-btn {
            width: 100%;
            background-color: var(--teal-btn);
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 0 #008f7a;
            margin-top: 10px;
        }
        .action-btn:hover { transform: translateY(2px); box-shadow: 0 2px 0 #008f7a; }
        .btn-dark { background-color: #006064; box-shadow: 0 4px 0 #00363a; }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--overlay-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .trade-card {
            background: white;
            width: 550px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .trade-header {
            padding: 15px;
            text-align: center;
            color: var(--blue-border);
            font-size: 20px;
            font-weight: bold;
            border-bottom: 1px solid #eee;
        }

        .trade-body {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .trade-item { text-align: center; width: 140px; }
        .food-icon-lg { font-size: 50px; display: block; margin-bottom: 10px; }

        .spinner-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid var(--teal-btn);
            border-radius: 8px;
            overflow: hidden;
        }
        .spin-btn { background: var(--teal-btn); color: white; border: none; width: 100%; cursor: pointer; }
        .spin-val { padding: 10px; font-size: 20px; font-weight: bold; width: 100%; border: none; text-align: center; }

        .gain-loss-display {
            text-align: center;
            padding: 15px;
            background: #f9f9f9;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            font-size: 18px;
            color: #555;
        }

        .trade-actions { display: flex; }
        .modal-btn { flex: 1; padding: 20px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; color: white; }
        .btn-accept { background: var(--teal-btn); }
        .btn-decline { background: #999; }

        /* STATUS BAR */
        .status-bar {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: #2C3E50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            font-family: monospace;
            box-sizing: border-box;
            font-size: 18px;
        }
    </style>
</head>
<body>

<div id="screen-intro" class="container">
    <div style="background:white; padding:40px; border-radius:20px; text-align:left; max-width:600px; margin:0 auto;">
        <h1 style="text-align: center; color: var(--teal-btn);">Market Simulation</h1>
        <p><strong>Goal:</strong> Sell the most Combos (1 Burger + 1 Fry).</p>
        <p><strong>The Market:</strong></p>
        <ul>
            <li>Half the class is good at Burgers. Half is good at Fries.</li>
            <li><strong>Opportunity Cost:</strong> If you make Burgers efficiently, your "cost" for Fries is high. You should trade!</li>
            <li><strong>Bad Deals:</strong> Some students will offer you bad trades. Check the math before accepting.</li>
        </ul>
        <div style="text-align: center; margin-top: 30px;">
            <button class="action-btn" onclick="startGame()">Join Market</button>
        </div>
    </div>
</div>

<div id="screen-game" class="container hidden">
    
    <div class="prod-bar">
        <span>Your Production: <span id="rate-f">8</span> Fries OR <span id="rate-b">4</span> Burgers / min</span>
    </div>

    <div class="game-layout">
        <div class="prep-box">
            <h3 style="margin-top:0; color:#2D74DA;">Prep Time</h3>
            <div class="input-group">
                <button class="control-btn" onclick="adjustTime('burgers', -1)">-</button>
                <div style="font-weight:bold; font-size:20px;"><span id="time-b">15</span> min</div>
                <button class="control-btn" onclick="adjustTime('burgers', 1)">+</button>
            </div>
            <div class="input-group">
                <button class="control-btn" onclick="adjustTime('fries', -1)">-</button>
                <div style="font-weight:bold; font-size:20px;"><span id="time-f">15</span> min</div>
                <button class="control-btn" onclick="adjustTime('fries', 1)">+</button>
            </div>
            <p style="color:#666;">Status: <strong id="partner-name" style="color:green">Connected to Class Market</strong></p>
        </div>

        <div class="output-box">
            <h3 style="margin-top:0; color:#2D74DA;">Your Inventory</h3>
            
            <div class="inventory-row">
                <span>üçî Burgers</span>
                <span>
                    <span id="inv-b">60</span> 
                    <span id="diff-b" class="trade-diff"></span>
                </span>
            </div>
            <div class="inventory-row">
                <span>üçü Fries</span>
                <span>
                    <span id="inv-f">120</span>
                    <span id="diff-f" class="trade-diff"></span>
                </span>
            </div>

            <button class="action-btn btn-dark" onclick="openProposeModal()">Broadcast Offer</button>
            <button class="action-btn" onclick="submitRound()">Bring <span id="combo-count">60</span> Combos</button>
        </div>
    </div>
</div>

<div id="modal-propose" class="modal-overlay hidden">
    <div class="trade-card">
        <div class="trade-header">
            <span>üì¢ Broadcast Offer to Class</span>
        </div>
        <div class="trade-body">
            <div class="trade-item">
                <div class="food-icon-lg">üì§</div>
                <div>You Give</div>
                <div class="spinner-box">
                    <button class="spin-btn" onclick="adjustOffer('give', 1)">‚ñ≤</button>
                    <input id="offer-give-val" class="spin-val" value="5" readonly oninput="calculateGain()">
                    <button class="spin-btn" onclick="adjustOffer('give', -1)">‚ñº</button>
                </div>
                <select id="offer-give-type" onchange="calculateGain()" style="width:100%; margin-top:5px; padding:5px;">
                    <option value="burgers">Burgers</option>
                    <option value="fries">Fries</option>
                </select>
            </div>

            <div style="font-weight:bold; color:#aaa;">FOR</div>

            <div class="trade-item">
                <div class="food-icon-lg">üì•</div>
                <div>You Get</div>
                <div class="spinner-box">
                    <button class="spin-btn" onclick="adjustOffer('get', 1)">‚ñ≤</button>
                    <input id="offer-get-val" class="spin-val" value="5" readonly oninput="calculateGain()">
                    <button class="spin-btn" onclick="adjustOffer('get', -1)">‚ñº</button>
                </div>
                <select id="offer-get-type" onchange="calculateGain()" style="width:100%; margin-top:5px; padding:5px;">
                    <option value="fries">Fries</option>
                    <option value="burgers">Burgers</option>
                </select>
            </div>
        </div>

        <div class="gain-loss-display">
            Impact on You: <strong id="propose-gain-val">0</strong> Combos
        </div>

        <div class="trade-actions">
            <button class="modal-btn btn-accept" onclick="sendProposal()">Broadcast</button>
            <button class="modal-btn btn-decline" onclick="closeModal('modal-propose')">Cancel</button>
        </div>
    </div>
</div>

<div id="modal-incoming" class="modal-overlay hidden">
    <div class="trade-card" style="border: 4px solid var(--orange-alert);">
        <div class="trade-header" style="background:var(--orange-alert); color:white;">
            <span id="inc-title">üîî Offer from Truck_101</span>
        </div>
        <div class="trade-body">
            <div class="trade-item">
                <div class="food-icon-lg" id="inc-give-icon">üçü</div>
                <div>They Give</div>
                <h1 id="inc-give-amt" style="margin:5px 0;">8</h1>
                <div id="inc-give-name">Fries</div>
            </div>
            
            <div style="font-weight:bold; color:#aaa;">FOR</div>

            <div class="trade-item">
                <div class="food-icon-lg" id="inc-get-icon">üçî</div>
                <div>They Want</div>
                <h1 id="inc-get-amt" style="margin:5px 0;">4</h1>
                <div id="inc-get-name">Burgers</div>
            </div>
        </div>

        <div class="gain-loss-display">
            Impact on You: <strong id="inc-gain-val">0</strong> Combos
        </div>

        <div class="trade-actions">
            <button class="modal-btn btn-accept" onclick="acceptIncoming()">Accept</button>
            <button class="modal-btn btn-decline" onclick="declineIncoming()">Decline</button>
        </div>
    </div>
</div>

<div id="modal-result" class="modal-overlay hidden">
    <div class="trade-card" style="padding: 30px;">
        <h2 style="color:var(--teal-btn);">Round Complete</h2>
        <h1><span id="res-score">0</span> Combos Sold</h1>
        <p id="res-msg" style="color:#666;"></p>
        <button class="action-btn" onclick="location.reload()">Play Again</button>
    </div>
</div>

<div class="status-bar">
    <div>Simulation Active</div>
    <div id="timer">02:00</div>
</div>

<script>
    // --- STATE VARIABLES ---
    let timeB = 15, timeF = 15;
    let rateB = 4, rateF = 8;
    let productionB = 0, productionF = 0;
    let netTradeB = 0, netTradeF = 0;
    
    // Opportunity Costs (OC)
    let myOC_Burgers = 0; // Cost of 1 burger in fries

    // --- MARKET VARIABLES ---
    let botInterval;
    let activeBotOffer = null;

    // --- GAME ENGINE ---
    function startGame() {
        document.getElementById('screen-intro').classList.add('hidden');
        document.getElementById('screen-game').classList.remove('hidden');
        
        // 1. Randomize Player (You)
        // 50% chance to be "Burger Pro" (RateB > RateF)
        // 50% chance to be "Fry Pro" (RateF > RateB)
        if (Math.random() > 0.5) {
            rateB = 8; rateF = 4; // Burger Pro
        } else {
            rateB = 4; rateF = 8; // Fry Pro
        }

        // Calculate my Opportunity Cost
        // If I make 4 B and 8 F: 1 B costs 2 F.
        myOC_Burgers = rateF / rateB;

        document.getElementById('rate-b').innerText = rateB;
        document.getElementById('rate-f').innerText = rateF;

        updateEngine();
        
        // Start Random Bot Offers (The "Market")
        botInterval = setInterval(triggerBotProposal, 6000 + Math.random() * 8000); // 6-14s delay
        
        startTimer();
    }

    function adjustTime(type, val) {
        if(type === 'burgers') {
            if(val > 0 && timeF > 0) { timeB++; timeF--; }
            if(val < 0 && timeB > 0) { timeB--; timeF++; }
        } else {
            if(val > 0 && timeB > 0) { timeF++; timeB--; }
            if(val < 0 && timeF > 0) { timeF--; timeB++; }
        }
        updateEngine();
    }

    function updateEngine() {
        productionB = timeB * rateB;
        productionF = timeF * rateF;
        
        let finalB = Math.max(0, productionB + netTradeB);
        let finalF = Math.max(0, productionF + netTradeF);

        document.getElementById('time-b').innerText = timeB;
        document.getElementById('time-f').innerText = timeF;
        document.getElementById('inv-b').innerText = finalB;
        document.getElementById('inv-f').innerText = finalF;

        updateDiff('diff-b', netTradeB);
        updateDiff('diff-f', netTradeF);

        document.getElementById('combo-count').innerText = Math.min(finalB, finalF);
    }

    function updateDiff(id, val) {
        let el = document.getElementById(id);
        if(val === 0) {
            el.innerText = "";
        } else {
            el.innerText = val > 0 ? `(+${val})` : `(${val})`;
            el.className = val > 0 ? "trade-diff diff-pos" : "trade-diff diff-neg";
        }
    }

    // --- SENDING PROPOSALS (BROADCAST) ---
    function openProposeModal() {
        document.getElementById('modal-propose').classList.remove('hidden');
        calculateGain();
    }

    function adjustOffer(side, delta) {
        let el = document.getElementById('offer-' + side + '-val');
        let val = parseInt(el.value) + delta;
        if(val < 1) val = 1;
        el.value = val;
        calculateGain();
    }

    function calculateGain() {
        let giveType = document.getElementById('offer-give-type').value;
        let getType = document.getElementById('offer-get-type').value;
        let giveAmt = parseInt(document.getElementById('offer-give-val').value);
        let getAmt = parseInt(document.getElementById('offer-get-val').value);

        let diff = getScoreDiff(productionB, productionF, netTradeB, netTradeF, giveType, giveAmt, getType, getAmt);
        
        let el = document.getElementById('propose-gain-val');
        el.innerText = diff > 0 ? "+" + diff : diff;
        el.style.color = diff >= 0 ? "green" : "red";
    }

    function sendProposal() {
        let giveType = document.getElementById('offer-give-type').value;
        let getType = document.getElementById('offer-get-type').value;
        let giveAmt = parseInt(document.getElementById('offer-give-val').value);
        let getAmt = parseInt(document.getElementById('offer-get-val').value);
        
        let userHas = (giveType === 'burgers') ? (productionB + netTradeB) : (productionF + netTradeF);
        if(userHas < giveAmt) {
            alert("Insufficient inventory!");
            return;
        }

        // MARKET LOGIC (Did anyone accept?)
        // Calculate Implied Price (Terms of Trade)
        // If trading Burgers for Fries: Price = Fries / Burgers
        let price = (giveType === 'burgers') ? (getAmt / giveAmt) : (giveAmt / getAmt);
        
        // Simulating the "Other Half" of the class
        // Opponent OC (approximate). If I am 2, they are 0.5. 
        // A trade works if price is BETWEEN OCs.
        let marketAccept = false;

        // If I am getting a "Great Deal" (e.g., getting 10 Fries for 1 Burger), the market rejects.
        // If I am offering a "Fair Deal" (e.g., 1 Burger for 1.5 Fries), market accepts.
        
        // Simplified Logic: 
        // If user gain is MASSIVE (> 5 combos), likely bad for opponent -> Reject.
        // If user gain is MODERATE (1-3 combos), good for opponent -> Accept.
        
        // Let's create a temporary Random Bot to check this against
        let randomBotRateB = (Math.random() > 0.5) ? 8 : 4;
        let randomBotRateF = (randomBotRateB === 8) ? 4 : 8;
        
        // Does this trade help the Random Bot?
        // Assume Random Bot specialized
        let botB = (randomBotRateB > randomBotRateF) ? 30 * 8 : 0;
        let botF = (randomBotRateB > randomBotRateF) ? 0 : 30 * 8;
        
        // Calculate Bot Gain
        // Note: User Gives = Bot Gets
        let botDiff = getScoreDiff(botB, botF, 0, 0, getType, getAmt, giveType, giveAmt);

        closeModal('modal-propose');

        setTimeout(() => {
            if(botDiff > 0) {
                alert("Truck_" + Math.floor(Math.random()*900+100) + " ACCEPTED your offer!");
                if(giveType === 'burgers') { netTradeB -= giveAmt; netTradeF += getAmt; }
                else { netTradeF -= giveAmt; netTradeB += getAmt; }
                updateEngine();
            } else {
                alert("No one accepted. (Your price was likely too high for the market).");
            }
        }, 600);
    }

    // --- RECEIVING PROPOSALS (MARKET -> USER) ---
    function triggerBotProposal() {
        if(!document.getElementById('modal-result').classList.contains('hidden')) return;

        // Create a random Bot from the class
        let botID = Math.floor(Math.random() * 900 + 100);
        let bRateB = (Math.random() > 0.5) ? 8 : 4;
        let bRateF = (bRateB === 8) ? 4 : 8;

        // Bot gives what they are good at
        let giveType = (bRateB > bRateF) ? 'Burgers' : 'Fries';
        let wantType = (giveType === 'Burgers') ? 'Fries' : 'Burgers';

        // Bot Logic: Offer a price.
        // If Bot makes Burgers (Low Cost), they will sell cheap or dear.
        // Price Range: 0.5 to 2.0.
        // "Bad Deal" for Player: Price = 0.6 (Bot gives 0.6 F per B).
        // "Good Deal" for Player: Price = 1.5 (Bot gives 1.5 F per B).
        
        let isGoodDeal = Math.random() > 0.4; // 60% chance of fair/good deal
        
        let amtGive, amtAsk;

        if (giveType === 'Burgers') {
            // Bot Gives Burgers, Wants Fries.
            amtGive = 5; 
            // Fair price might be 1:1.5. Bad price 1:3. Good price 1:1.
            amtAsk = isGoodDeal ? 4 : 8; 
        } else {
            // Bot Gives Fries, Wants Burgers
            amtGive = 8;
            amtAsk = isGoodDeal ? 4 : 2; 
        }

        activeBotOffer = { giveType: giveType, giveAmt: amtGive, askType: wantType, askAmt: amtAsk };

        document.getElementById('inc-title').innerText = "üîî Offer from Truck_" + botID;
        document.getElementById('inc-give-icon').innerText = (giveType === 'Burgers') ? 'üçî' : 'üçü';
        document.getElementById('inc-give-name').innerText = giveType;
        document.getElementById('inc-give-amt').innerText = amtGive;

        document.getElementById('inc-get-icon').innerText = (wantType === 'Burgers') ? 'üçî' : 'üçü';
        document.getElementById('inc-get-name').innerText = wantType;
        document.getElementById('inc-get-amt').innerText = amtAsk;

        calculateIncomingGain(); 
        document.getElementById('modal-incoming').classList.remove('hidden');
    }

    function calculateIncomingGain() {
        if(!activeBotOffer) return;
        let diff = getScoreDiff(productionB, productionF, netTradeB, netTradeF, activeBotOffer.askType, activeBotOffer.askAmt, activeBotOffer.giveType, activeBotOffer.giveAmt);
        
        let el = document.getElementById('inc-gain-val');
        el.innerText = diff > 0 ? "+" + diff : diff;
        el.style.color = diff >= 0 ? "green" : "red";
    }

    function acceptIncoming() {
        let payType = activeBotOffer.askType;
        let payAmt = activeBotOffer.askAmt;
        let userHas = (payType === 'Burgers') ? (productionB + netTradeB) : (productionF + netTradeF);
        
        if(userHas < payAmt) {
            alert("Insufficient inventory!");
            return;
        }

        if(payType === 'Burgers') { netTradeB -= payAmt; netTradeF += activeBotOffer.giveAmt; }
        else { netTradeF -= payAmt; netTradeB += activeBotOffer.giveAmt; }

        updateEngine();
        closeModal('modal-incoming');
    }

    function declineIncoming() { closeModal('modal-incoming'); }

    // --- MATH HELPER ---
    function getScoreDiff(prodB, prodF, tradeB, tradeF, giveType, giveAmt, getType, getAmt) {
        let currB = prodB + tradeB;
        let currF = prodF + tradeF;
        let currScore = Math.min(currB, currF);

        let newB = currB;
        let newF = currF;

        if (giveType.toLowerCase() === 'burgers') newB -= giveAmt; else newF -= giveAmt;
        if (getType.toLowerCase() === 'burgers') newB += getAmt; else newF += getAmt;

        let newScore = Math.min(Math.max(0, newB), Math.max(0, newF));
        return newScore - currScore;
    }

    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    
    function submitRound() {
        clearInterval(botInterval);
        document.getElementById('res-score').innerText = document.getElementById('combo-count').innerText;
        document.getElementById('res-msg').innerText = "Simulation Complete.";
        document.getElementById('modal-result').classList.remove('hidden');
    }

    function startTimer() {
        let sec = 120;
        let timerInt = setInterval(() => {
            sec--;
            let m = Math.floor(sec/60);
            let s = sec%60;
            document.getElementById('timer').innerText = `0${m}:${s<10?'0'+s:s}`;
            if(sec <= 0) { clearInterval(timerInt); submitRound(); }
        }, 1000);
    }
</script>

</body>
</html>
